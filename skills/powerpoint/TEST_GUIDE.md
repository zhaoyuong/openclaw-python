# PowerPoint Skill Testing Guide

Guide for testing the PowerPoint generation skill end-to-end.

## Prerequisites

1. **Install Dependencies**

```bash
cd /Users/openbot/Desktop/xopen/openclaw-python

# Install python-pptx
pip install python-pptx>=0.6.23

# Or install all dependencies
pip install -e .
```

2. **Verify Installation**

```bash
python3 -c "from pptx import Presentation; print('âœ… python-pptx installed')"
```

3. **Create Default Template** (optional)

```bash
python openclaw/skills/powerpoint/scripts/create_default_template.py
```

## Unit Tests

### Test 1: Script Execution

Test the generation script directly:

```bash
# Create test config
cat > /tmp/test_ppt_config.json << 'EOF'
{
  "title": "Test Presentation",
  "author": "OpenClaw Tester",
  "slides": [
    {
      "layout": "title",
      "title": "PowerPoint Skill Test",
      "subtitle": "Testing Basic Generation"
    },
    {
      "layout": "content",
      "title": "Test Points",
      "content": {
        "bullets": [
          "First bullet point",
          "Second bullet point",
          "Third bullet point"
        ]
      }
    },
    {
      "layout": "section",
      "title": "Section Header"
    },
    {
      "layout": "content",
      "title": "Conclusion",
      "content": {
        "text": "This is a test presentation generated by OpenClaw PowerPoint skill."
      }
    }
  ]
}
EOF

# Generate presentation
python openclaw/skills/powerpoint/scripts/generate_ppt.py \
  --config /tmp/test_ppt_config.json \
  --output /tmp/test_presentation.pptx

# Verify output
if [ -f /tmp/test_presentation.pptx ]; then
  echo "âœ… Presentation generated successfully"
  ls -lh /tmp/test_presentation.pptx
else
  echo "âŒ Presentation generation failed"
fi
```

**Expected result:** File created at `/tmp/test_presentation.pptx` (typically 30-50KB)

### Test 2: Skill Loading

Verify the skill is discovered by SkillLoader:

```python
from pathlib import Path
from openclaw.skills.loader import SkillLoader

loader = SkillLoader()
skills = loader.load_from_directory(Path("openclaw/skills/powerpoint"), "test")

if skills:
    skill = skills[0]
    print(f"âœ… Skill loaded: {skill.name}")
    print(f"   Description: {skill.metadata.description[:60]}...")
else:
    print("âŒ Skill not found")
```

**Expected result:** Skill named "powerpoint" is discovered

### Test 3: Helper Scripts

Test add_slide.py:

```bash
# Create a basic presentation first
python3 << 'EOF'
from pptx import Presentation
prs = Presentation()
prs.save('/tmp/base.pptx')
EOF

# Add a slide using helper
python openclaw/skills/powerpoint/scripts/add_slide.py \
  --pptx /tmp/base.pptx \
  --layout content \
  --title "Added Slide" \
  --content '{"bullets": ["Point A", "Point B"]}' \
  --output /tmp/base_with_slide.pptx

# Verify
if [ -f /tmp/base_with_slide.pptx ]; then
  echo "âœ… Slide added successfully"
else
  echo "âŒ Add slide failed"
fi
```

## Integration Tests

### Test 4: Gateway Integration

Test that skills are loaded when gateway starts:

```bash
# Start gateway (if not already running)
cd /Users/openbot/Desktop/xopen/openclaw-python
python start_gateway_with_telegram.py
```

Check logs for:
```
INFO - ðŸ§© Loaded skills from /path/to/skills
INFO - âœ… Skill: powerpoint
```

### Test 5: End-to-End via Telegram

**Setup:**
1. Ensure gateway is running with Telegram channel
2. Have Telegram bot token configured
3. Be able to message the bot

**Test steps:**

1. **Simple request:**
   - Send to bot: "Create a 3-slide presentation about Python programming"
   - Expected: Bot generates config, runs script, sends .pptx file

2. **Specific content:**
   - Send: "Create a presentation with title 'AI Overview', and 3 content slides about machine learning, deep learning, and neural networks"
   - Expected: Bot creates presentation with specified structure

3. **With theme:**
   - Send: "Create a professional presentation about our Q1 results with 5 slides"
   - Expected: Bot generates styled presentation

**Verification:**
- Receive .pptx file in Telegram
- Download and open in PowerPoint/LibreOffice
- Verify content matches request
- Check file size is reasonable (typically 30-200KB)

## Test Commands

### Quick Test Script

```bash
#!/bin/bash
# test_powerpoint_skill.sh

set -e

echo "=== PowerPoint Skill Test Suite ==="

# Test 1: Dependencies
echo "Test 1: Check dependencies..."
python3 -c "from pptx import Presentation" && echo "âœ… python-pptx available" || echo "âŒ python-pptx missing"

# Test 2: Script execution
echo "Test 2: Generate test presentation..."
cat > /tmp/test_config.json << 'EOF'
{
  "title": "Test",
  "slides": [
    {"layout": "title", "title": "Test", "subtitle": "Subtitle"},
    {"layout": "content", "title": "Content", "content": {"bullets": ["A", "B"]}}
  ]
}
EOF

python openclaw/skills/powerpoint/scripts/generate_ppt.py \
  --config /tmp/test_config.json \
  --output /tmp/test.pptx

if [ -f /tmp/test.pptx ]; then
  echo "âœ… Generation successful"
  ls -lh /tmp/test.pptx
else
  echo "âŒ Generation failed"
  exit 1
fi

# Test 3: File is valid
echo "Test 3: Verify file format..."
file /tmp/test.pptx | grep -q "Microsoft PowerPoint" && echo "âœ… Valid PPTX file" || echo "âš ï¸  File format check skipped"

# Test 4: Skill structure
echo "Test 4: Verify skill structure..."
test -f openclaw/skills/powerpoint/SKILL.md && echo "âœ… SKILL.md exists" || echo "âŒ SKILL.md missing"
test -d openclaw/skills/powerpoint/scripts && echo "âœ… scripts/ exists" || echo "âŒ scripts/ missing"
test -d openclaw/skills/powerpoint/assets && echo "âœ… assets/ exists" || echo "âŒ assets/ missing"
test -d openclaw/skills/powerpoint/references && echo "âœ… references/ exists" || echo "âŒ references/ missing"

echo ""
echo "=== Test Suite Complete ==="
```

Save as `test_powerpoint_skill.sh` and run:

```bash
chmod +x test_powerpoint_skill.sh
./test_powerpoint_skill.sh
```

## Troubleshooting

### Issue: "python-pptx not installed"
**Solution:** Run `pip install python-pptx>=0.6.23`

### Issue: "Template file not found"
**Solution:** The script will create a blank presentation. To use the default template:
```bash
python openclaw/skills/powerpoint/scripts/create_default_template.py
```

### Issue: "Telegram send_media fails with local file"
**Solution:** 
- Verify file path is absolute
- Check file exists and is readable
- Ensure file size is under 50MB
- Check Telegram channel logs for detailed error

### Issue: "Skill not discovered by gateway"
**Solution:**
- Verify SKILL.md has correct YAML frontmatter
- Check logs for skill loading errors
- Ensure skill directory is in openclaw/skills/
- Restart gateway to reload skills

## Expected Behavior

When working correctly:

1. **User sends request** â†’ "Create a presentation about X"
2. **Skill triggers** â†’ Description matches request intent
3. **Agent reads SKILL.md** â†’ Gets generation instructions
4. **Agent creates config** â†’ JSON with slide definitions
5. **Agent runs script** â†’ `generate_ppt.py --config ... --output ...`
6. **Script generates file** â†’ Creates .pptx in workspace
7. **Agent sends file** â†’ Uses Telegram send_media with local path
8. **User receives file** â†’ Can open and view in PowerPoint

## Performance Benchmarks

- Simple 3-slide presentation: ~1-2 seconds
- 10-slide presentation: ~2-3 seconds
- 50-slide presentation: ~5-10 seconds
- File sizes: 30-200KB (text only), 500KB-5MB (with images)

## Success Criteria

- âœ… Script generates valid .pptx files
- âœ… Skill is auto-discovered by SkillLoader
- âœ… YAML frontmatter is valid
- âœ… Files can be sent via Telegram
- âœ… Generated presentations open in PowerPoint/LibreOffice
- âœ… Content matches user request
- âœ… No errors in gateway logs
