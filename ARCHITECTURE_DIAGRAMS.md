# OpenClaw æ¶æ„å›¾è§£

> é€šè¿‡å¯è§†åŒ–å›¾è¡¨ç†è§£ OpenClaw çš„çœŸå®æ¶æ„

---

## ç›®å½•

1. [é”™è¯¯ç†è§£ vs æ­£ç¡®ç†è§£](#é”™è¯¯ç†è§£-vs-æ­£ç¡®ç†è§£)
2. [å®Œæ•´æ¶ˆæ¯æµç¨‹](#å®Œæ•´æ¶ˆæ¯æµç¨‹)
3. [Gateway ä¸‰ä¸ªèŒè´£](#gateway-ä¸‰ä¸ªèŒè´£)
4. [é€šä¿¡æ–¹å¼å¯¹æ¯”](#é€šä¿¡æ–¹å¼å¯¹æ¯”)
5. [é…å¯¹æœºåˆ¶](#é…å¯¹æœºåˆ¶)

---

## é”™è¯¯ç†è§£ vs æ­£ç¡®ç†è§£

### âŒ å¸¸è§é”™è¯¯ç†è§£

å¾ˆå¤šäººè¯¯ä»¥ä¸º Telegram Bot æ˜¯ Gateway çš„å®¢æˆ·ç«¯ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Telegram Bot â”‚ (è¯¯ä»¥ä¸ºæ˜¯å®¢æˆ·ç«¯)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ WebSocket (âŒ é”™è¯¯)
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Gateway    â”‚
â”‚   Server     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Agent     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆè¿™æ˜¯é”™è¯¯çš„ï¼Ÿ**
1. Telegram Bot ä¸é€šè¿‡ WebSocket è¿æ¥
2. Bot ä¸æ˜¯ Gateway çš„å®¢æˆ·ç«¯
3. æ¶ˆæ¯ä¸ç»è¿‡ Gateway è·¯ç”±

### âœ… æ­£ç¡®ç†è§£

Telegram Bot æ˜¯æœåŠ¡å™¨ç«¯æ’ä»¶ï¼Œå’Œ Gateway åœ¨åŒä¸€è¿›ç¨‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OpenClaw Server (å•è¿›ç¨‹)                    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚   Gateway    â”‚                                      â”‚
â”‚  â”‚   Server     â”‚                                      â”‚
â”‚  â”‚              â”‚                                      â”‚
â”‚  â”‚  èŒè´£:       â”‚                                      â”‚
â”‚  â”‚  â€¢ ç®¡ç†ç”Ÿå‘½å‘¨æœŸ                                     â”‚
â”‚  â”‚  â€¢ WebSocket API                                   â”‚
â”‚  â”‚  â€¢ äº‹ä»¶å¹¿æ’­  â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚          â”‚ manages (start/stop)                        â”‚
â”‚          â”‚                                             â”‚
â”‚          â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Telegram Bot â”‚  å‡½æ•°è°ƒç”¨ â”‚    Agent     â”‚          â”‚
â”‚  â”‚   (æ’ä»¶)     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   Runtime    â”‚          â”‚
â”‚  â”‚              â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   è¿”å›å€¼   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â†•                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ HTTP                   â†• WebSocket
     Telegram API           å¤–éƒ¨å®¢æˆ·ç«¯ (UI/CLI)
```

**å…³é”®ç‚¹**ï¼š
1. Bot å’Œ Gateway åœ¨åŒä¸€è¿›ç¨‹
2. Bot é€šè¿‡å‡½æ•°è°ƒç”¨è®¿é—® Agent
3. Gateway ç®¡ç† Bot ç”Ÿå‘½å‘¨æœŸ
4. Gateway çš„ WebSocket æœåŠ¡å¤–éƒ¨å®¢æˆ·ç«¯

---

## å®Œæ•´æ¶ˆæ¯æµç¨‹

### Telegram ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ—¶é—´çº¿                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. ç”¨æˆ·åœ¨ Telegram å®¢æˆ·ç«¯è¾“å…¥ "Hello"                        â”‚
â”‚     â””â”€â†’ ç”¨æˆ·ç‚¹å‡»å‘é€                                          â”‚
â”‚                                                              â”‚
â”‚  2. Telegram å®¢æˆ·ç«¯ â”€HTTPSâ”€â†’ Telegram API æœåŠ¡å™¨             â”‚
â”‚     â””â”€â†’ API æœåŠ¡å™¨å­˜å‚¨æ¶ˆæ¯                                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  OpenClaw Server è¿›ç¨‹å†…                            â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  3. Telegram Bot è½®è¯¢                             â”‚      â”‚
â”‚  â”‚     â””â”€â†’ HTTP GET /getUpdates                      â”‚      â”‚
â”‚  â”‚     â””â”€â†’ æ”¶åˆ°æ–°æ¶ˆæ¯                                â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  4. Bot è§£ææ¶ˆæ¯                                   â”‚      â”‚
â”‚  â”‚     â””â”€â†’ åˆ›å»º InboundMessage å¯¹è±¡                  â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  5. è°ƒç”¨æ¶ˆæ¯å¤„ç†å™¨ (å‡½æ•°è°ƒç”¨)                      â”‚      â”‚
â”‚  â”‚     â””â”€â†’ handle_telegram_message(message)          â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  6. è·å– Session (å‡½æ•°è°ƒç”¨)                       â”‚      â”‚
â”‚  â”‚     â””â”€â†’ session_manager.get_session(id)           â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  7. è°ƒç”¨ Agent (å‡½æ•°è°ƒç”¨)                         â”‚      â”‚
â”‚  â”‚     â””â”€â†’ agent_runtime.run_turn(session, "Hello") â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚      â”‚
â”‚  â”‚     â”‚ Agent å‘é€äº‹ä»¶                      â”‚       â”‚      â”‚
â”‚  â”‚     â”‚ emit("agent.start")                â”‚       â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚  â”‚                  â”‚                               â”‚      â”‚
â”‚  â”‚                  â†“                               â”‚      â”‚
â”‚  â”‚           Gateway æ”¶åˆ°äº‹ä»¶                        â”‚      â”‚
â”‚  â”‚                  â”‚                               â”‚      â”‚
â”‚  â”‚                  â†“                               â”‚      â”‚
â”‚  â”‚           å¹¿æ’­ç»™æ‰€æœ‰ WebSocket å®¢æˆ·ç«¯             â”‚      â”‚
â”‚  â”‚           â”€WebSocketâ”€â†’ UI/CLI æ”¶åˆ°å®æ—¶æ›´æ–°       â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  8. Agent è°ƒç”¨ LLM API                            â”‚      â”‚
â”‚  â”‚     â””â”€â†’ HTTPS POST to Claude/GPT API             â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  9. LLM è¿”å›å“åº”                                  â”‚      â”‚
â”‚  â”‚     â””â”€â†’ "Hello! How can I help?"                 â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚      â”‚
â”‚  â”‚     â”‚ Agent å‘é€æ–‡æœ¬äº‹ä»¶                  â”‚       â”‚      â”‚
â”‚  â”‚     â”‚ emit("agent.text", text)           â”‚       â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚  â”‚                  â”‚                               â”‚      â”‚
â”‚  â”‚                  â†“                               â”‚      â”‚
â”‚  â”‚           Gateway å¹¿æ’­äº‹ä»¶                        â”‚      â”‚
â”‚  â”‚           â”€WebSocketâ”€â†’ UI/CLI çœ‹åˆ°æ–‡æœ¬           â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  10. Agent è¿”å›å“åº” (å‡½æ•°è¿”å›)                    â”‚      â”‚
â”‚  â”‚      â””â”€â†’ handle_telegram_message æ”¶åˆ°å“åº”         â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚  11. Bot å‘é€å›å¤                                 â”‚      â”‚
â”‚  â”‚      â””â”€â†’ telegram_channel.send_text(...)         â”‚      â”‚
â”‚  â”‚      â””â”€â†’ HTTP POST to Telegram API               â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚      â”‚
â”‚  â”‚     â”‚ Agent å‘é€å®Œæˆäº‹ä»¶                  â”‚       â”‚      â”‚
â”‚  â”‚     â”‚ emit("agent.done")                 â”‚       â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚  â”‚                  â”‚                               â”‚      â”‚
â”‚  â”‚                  â†“                               â”‚      â”‚
â”‚  â”‚           Gateway å¹¿æ’­å®Œæˆäº‹ä»¶                    â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚      â”‚
â”‚  â”‚                                                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  12. Telegram API â”€æ¨é€â”€â†’ Telegram å®¢æˆ·ç«¯                    â”‚
â”‚      â””â”€â†’ ç”¨æˆ·çœ‹åˆ°å›å¤ "Hello! How can I help?"               â”‚
â”‚                                                              â”‚
â”‚  âœ… å®Œæˆ                                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¹¶è¡Œæµç¨‹ï¼šWebSocket å®¢æˆ·ç«¯åŒæ­¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebSocket å®¢æˆ·ç«¯ (Control UI)          â”‚
â”‚                                         â”‚
â”‚  æ—¶é—´ç‚¹1: Agent å¼€å§‹å¤„ç†                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ”¶åˆ°äº‹ä»¶:                       â”‚   â”‚
â”‚  â”‚ {                               â”‚   â”‚
â”‚  â”‚   "event": "agent.start",       â”‚   â”‚
â”‚  â”‚   "payload": {                  â”‚   â”‚
â”‚  â”‚     "message": "Hello"          â”‚   â”‚
â”‚  â”‚   }                             â”‚   â”‚
â”‚  â”‚ }                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â†’ UI æ˜¾ç¤º "å¤„ç†ä¸­..."                â”‚
â”‚                                         â”‚
â”‚  æ—¶é—´ç‚¹2: Agent ç”Ÿæˆæ–‡æœ¬                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ”¶åˆ°äº‹ä»¶:                       â”‚   â”‚
â”‚  â”‚ {                               â”‚   â”‚
â”‚  â”‚   "event": "agent.text",        â”‚   â”‚
â”‚  â”‚   "payload": {                  â”‚   â”‚
â”‚  â”‚     "text": "Hello! How..."     â”‚   â”‚
â”‚  â”‚   }                             â”‚   â”‚
â”‚  â”‚ }                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â†’ UI å®æ—¶æ˜¾ç¤ºæ–‡æœ¬                    â”‚
â”‚                                         â”‚
â”‚  æ—¶é—´ç‚¹3: Agent å®Œæˆ                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ”¶åˆ°äº‹ä»¶:                       â”‚   â”‚
â”‚  â”‚ {                               â”‚   â”‚
â”‚  â”‚   "event": "agent.done"         â”‚   â”‚
â”‚  â”‚ }                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â””â”€â†’ UI æ˜¾ç¤º "å®Œæˆ"                     â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Gateway ä¸‰ä¸ªèŒè´£

### èŒè´£ 1ï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Gateway (ChannelManager)                 â”‚
â”‚                                                     â”‚
â”‚  ç®¡ç†æ‰€æœ‰ Channel çš„å¯åŠ¨ã€åœæ­¢å’Œç›‘æ§                 â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ startChannel(channelId, config)           â”‚    â”‚
â”‚  â”‚   â”œâ”€â†’ 1. åˆ›å»º channel å®ä¾‹                â”‚    â”‚
â”‚  â”‚   â”œâ”€â†’ 2. è®¾ç½®æ¶ˆæ¯å¤„ç†å™¨                   â”‚    â”‚
â”‚  â”‚   â”œâ”€â†’ 3. è°ƒç”¨ channel.start(config)       â”‚    â”‚
â”‚  â”‚   â””â”€â†’ 4. æ³¨å†Œåˆ° registry                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ stopChannel(channelId)                    â”‚    â”‚
â”‚  â”‚   â”œâ”€â†’ 1. æŸ¥æ‰¾ channel å®ä¾‹                â”‚    â”‚
â”‚  â”‚   â”œâ”€â†’ 2. è°ƒç”¨ channel.stop()              â”‚    â”‚
â”‚  â”‚   â””â”€â†’ 3. ä» registry ç§»é™¤                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ getChannelStatus()                        â”‚    â”‚
â”‚  â”‚   â””â”€â†’ è¿”å›æ‰€æœ‰ channels çš„è¿è¡ŒçŠ¶æ€        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            manages  â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Channels                           â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Telegram   â”‚  â”‚   Discord   â”‚  â”‚   Slack   â”‚  â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚           â”‚  â”‚
â”‚  â”‚  running âœ“  â”‚  â”‚  stopped âœ—  â”‚  â”‚running âœ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£ 2ï¼šWebSocket API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Gateway WebSocket API                  â”‚
â”‚           ws://localhost:8765                       â”‚
â”‚                                                     â”‚
â”‚  æ”¯æŒçš„æ–¹æ³•:                                         â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ method: "agent"                           â”‚    â”‚
â”‚  â”‚ â”œâ”€â†’ å‘é€æ¶ˆæ¯ç»™ Agent                      â”‚    â”‚
â”‚  â”‚ â”œâ”€â†’ æµå¼è¿”å›å“åº”                          â”‚    â”‚
â”‚  â”‚ â””â”€â†’ ç”¨äº: Control UI, CLI                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ method: "send"                            â”‚    â”‚
â”‚  â”‚ â”œâ”€â†’ é€šè¿‡æŒ‡å®š channel å‘é€æ¶ˆæ¯              â”‚    â”‚
â”‚  â”‚ â””â”€â†’ ç”¨äº: è¿œç¨‹å‘é€ Telegram æ¶ˆæ¯          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ method: "channels.list"                   â”‚    â”‚
â”‚  â”‚ â”œâ”€â†’ åˆ—å‡ºæ‰€æœ‰ channels                     â”‚    â”‚
â”‚  â”‚ â””â”€â†’ ç”¨äº: ç›‘æ§é¢æ¿                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ method: "sessions.list"                   â”‚    â”‚
â”‚  â”‚ â”œâ”€â†’ åˆ—å‡ºæ´»è·ƒä¼šè¯                          â”‚    â”‚
â”‚  â”‚ â””â”€â†’ ç”¨äº: Session ç®¡ç†                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ WebSocket
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤–éƒ¨å®¢æˆ·ç«¯                              â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Control UI  â”‚  â”‚     CLI     â”‚  â”‚  iOS App  â”‚  â”‚
â”‚  â”‚   (Web)     â”‚  â”‚  (Terminal) â”‚  â”‚  (Mobile) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£ 3ï¼šäº‹ä»¶å¹¿æ’­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Event Broadcasting                  â”‚
â”‚                                                     â”‚
â”‚  äº‹ä»¶æº:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Agent Runtime                     â”‚    â”‚
â”‚  â”‚                                           â”‚    â”‚
â”‚  â”‚  å¤„ç†æ¶ˆæ¯æ—¶å‘é€äº‹ä»¶:                       â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ emit("agent.start", {...})          â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ emit("agent.text", {...})           â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ emit("agent.tool_use", {...})       â”‚    â”‚
â”‚  â”‚  â””â”€â†’ emit("agent.done", {...})           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                               â”‚
â”‚                    â†“ äº‹ä»¶æ€»çº¿                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Gateway Event Handler             â”‚    â”‚
â”‚  â”‚                                           â”‚    â”‚
â”‚  â”‚  æ”¶åˆ°äº‹ä»¶åå¹¿æ’­:                           â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ éå†æ‰€æœ‰ WebSocket è¿æ¥              â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ å‘é€äº‹ä»¶ç»™æ¯ä¸ªå®¢æˆ·ç«¯                 â”‚    â”‚
â”‚  â”‚  â””â”€â†’ å¤„ç†æ–­å¼€è¿æ¥                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    â”‚                               â”‚
â”‚                    â†“ WebSocket broadcast           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯                   â”‚    â”‚
â”‚  â”‚                                           â”‚    â”‚
â”‚  â”‚  å®¢æˆ·ç«¯1 âœ“  æ”¶åˆ°äº‹ä»¶                      â”‚    â”‚
â”‚  â”‚  å®¢æˆ·ç«¯2 âœ“  æ”¶åˆ°äº‹ä»¶                      â”‚    â”‚
â”‚  â”‚  å®¢æˆ·ç«¯3 âœ—  æ–­å¼€è¿æ¥ (å·²ç§»é™¤)             â”‚    â”‚
â”‚  â”‚  å®¢æˆ·ç«¯4 âœ“  æ”¶åˆ°äº‹ä»¶                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

äº‹ä»¶æµç¨‹ç¤ºä¾‹:

1. Agent å¼€å§‹å¤„ç†
   emit("agent.start") â”€â†’ Gateway â”€â†’ å¹¿æ’­ â”€â†’ æ‰€æœ‰å®¢æˆ·ç«¯

2. Agent ç”Ÿæˆæ–‡æœ¬
   emit("agent.text") â”€â†’ Gateway â”€â†’ å¹¿æ’­ â”€â†’ æ‰€æœ‰å®¢æˆ·ç«¯
   (å®¢æˆ·ç«¯å®æ—¶çœ‹åˆ°æ–‡æœ¬)

3. Agent è°ƒç”¨å·¥å…·
   emit("agent.tool_use") â”€â†’ Gateway â”€â†’ å¹¿æ’­ â”€â†’ æ‰€æœ‰å®¢æˆ·ç«¯

4. Agent å®Œæˆ
   emit("agent.done") â”€â†’ Gateway â”€â†’ å¹¿æ’­ â”€â†’ æ‰€æœ‰å®¢æˆ·ç«¯
```

---

## é€šä¿¡æ–¹å¼å¯¹æ¯”

### å››ç§é€šä¿¡æ–¹å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é€šä¿¡æ–¹å¼å¯¹æ¯”                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Bot â†” Telegram API (ç½‘ç»œè¯·æ±‚)                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ Telegram Bot â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚ Telegram API â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Long Polling    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        & POST                                â”‚
â”‚     ç”¨é€”: æ¥æ”¶å’Œå‘é€ç”¨æˆ·æ¶ˆæ¯                                  â”‚
â”‚     å»¶è¿Ÿ: 50-200ms                                           â”‚
â”‚                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                              â”‚
â”‚  2. Bot â†” Agent (å‡½æ•°è°ƒç”¨)                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Python         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ Telegram Bot â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚    Agent     â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å‡½æ•°è°ƒç”¨         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        (åŒä¸€è¿›ç¨‹)                            â”‚
â”‚     ç”¨é€”: å¤„ç†æ¶ˆæ¯ï¼Œç”Ÿæˆå›å¤                                  â”‚
â”‚     å»¶è¿Ÿ: < 1Î¼s (å¾®ç§’)                                       â”‚
â”‚                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                              â”‚
â”‚  3. Gateway â†” å¤–éƒ¨å®¢æˆ·ç«¯ (WebSocket)                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   WebSocket       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚   Gateway    â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  Web UI/CLI  â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   åŒå‘é€šä¿¡         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚     ç”¨é€”: ä¸ºå¤–éƒ¨åº”ç”¨æä¾› API                                  â”‚
â”‚     å»¶è¿Ÿ: 10-50ms                                            â”‚
â”‚                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                              â”‚
â”‚  4. Agent â†” LLM API (ç½‘ç»œè¯·æ±‚)                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTPS         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚    Agent     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚ Claude/GPT   â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   POST/Stream     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚     ç”¨é€”: ç”Ÿæˆ AI å›å¤                                        â”‚
â”‚     å»¶è¿Ÿ: 500-3000ms                                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€§èƒ½å¯¹æ¯”

```
å»¶è¿Ÿå¯¹æ¯” (å•æ¬¡è°ƒç”¨):

å‡½æ•°è°ƒç”¨ (Botâ†’Agent)          <1Î¼s       â–ˆâ–ˆâ–ˆâ–ˆ
è¿›ç¨‹å†…é€šä¿¡                     ~10Î¼s      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
æœ¬åœ° WebSocket                 10-50ms    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
HTTP è¯·æ±‚ (Telegram API)       50-200ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
HTTPS è¯·æ±‚ (LLM API)          500-3000ms  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

ç»“è®º:
- Botâ†’Agent çš„å‡½æ•°è°ƒç”¨å‡ ä¹é›¶å»¶è¿Ÿ
- WebSocket é€‚åˆå®æ—¶æ›´æ–°
- HTTP é€‚åˆå¯é æ¶ˆæ¯ä¼ è¾“
- LLM API æ˜¯ä¸»è¦ç“¶é¢ˆ
```

---

## é…å¯¹æœºåˆ¶

### ä¸æ˜¯è®¾å¤‡é…å¯¹ï¼Œæ˜¯ç”¨æˆ·æˆæƒï¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Telegram Pairing æµç¨‹                  â”‚
â”‚                                                     â”‚
â”‚  åœºæ™¯: æ–°ç”¨æˆ·æƒ³è¦ç§èŠ Bot                            â”‚
â”‚                                                     â”‚
â”‚  Step 1: ç”¨æˆ·å‘é€ DM                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç”¨æˆ·: "Hello"                               â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ Bot æ£€æŸ¥: dmPolicy == "pairing"?           â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ Bot æ£€æŸ¥: user in allowlist?               â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ âœ— ä¸åœ¨ allowlist                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  Step 2: Bot ç”Ÿæˆé…å¯¹ç                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ code = generate_pairing_code()              â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ code = "ABC123"                            â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ store_pairing_request(user_id, code)       â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ Bot å›å¤ç”¨æˆ·:                               â”‚  â”‚
â”‚  â”‚ "æ‚¨éœ€è¦æˆæƒæ‰èƒ½ä½¿ç”¨æ­¤ Botã€‚                 â”‚  â”‚
â”‚  â”‚  è¯·å°†é…å¯¹ç å‘é€ç»™ç®¡ç†å‘˜ï¼š                   â”‚  â”‚
â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚  é…å¯¹ç : ABC123                            â”‚  â”‚
â”‚  â”‚                                             â”‚  â”‚
â”‚  â”‚  ç®¡ç†å‘˜æ‰¹å‡†åæ‚¨å°†å¯ä»¥ä½¿ç”¨ã€‚"                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  Step 3: ç”¨æˆ·è”ç³»ç®¡ç†å‘˜                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç”¨æˆ·: "æˆ‘çš„é…å¯¹ç æ˜¯ ABC123"                 â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ ç®¡ç†å‘˜: "å¥½çš„ï¼Œæˆ‘æ¥æ‰¹å‡†"                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  Step 4: ç®¡ç†å‘˜æ‰¹å‡†                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç®¡ç†å‘˜åœ¨æœåŠ¡å™¨æ‰§è¡Œ:                         â”‚  â”‚
â”‚  â”‚ $ openclaw pairing approve telegram ABC123 â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ ç³»ç»ŸæŸ¥æ‰¾ pending request                    â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ user_id = get_user_from_code("ABC123")     â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ add_to_allowlist(user_id)                  â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ delete_pairing_request("ABC123")           â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ âœ“ æ‰¹å‡†æˆåŠŸ                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  Step 5: ç”¨æˆ·å¯ä»¥ä½¿ç”¨                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç”¨æˆ·: "Hello" (é‡æ–°å‘é€)                    â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ Bot æ£€æŸ¥: user in allowlist?               â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ âœ“ åœ¨ allowlist ä¸­                          â”‚  â”‚
â”‚  â”‚  â†“                                          â”‚  â”‚
â”‚  â”‚ Bot: "Hello! How can I help?"              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pairing å­˜å‚¨ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Pairing Store                          â”‚
â”‚                                                     â”‚
â”‚  pending_requests = {                               â”‚
â”‚    "ABC123": {                                      â”‚
â”‚      "user_id": "123456",                           â”‚
â”‚      "channel": "telegram",                         â”‚
â”‚      "created_at": "2024-01-01T10:00:00Z"           â”‚
â”‚    },                                               â”‚
â”‚    "XYZ789": {                                      â”‚
â”‚      "user_id": "789012",                           â”‚
â”‚      "channel": "telegram",                         â”‚
â”‚      "created_at": "2024-01-01T10:05:00Z"           â”‚
â”‚    }                                                â”‚
â”‚  }                                                  â”‚
â”‚                                                     â”‚
â”‚  allowlist = {                                      â”‚
â”‚    "123456",  // å·²æ‰¹å‡†                             â”‚
â”‚    "234567",  // å·²æ‰¹å‡†                             â”‚
â”‚    "345678"   // å·²æ‰¹å‡†                             â”‚
â”‚  }                                                  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç‚¹

1. **Pairing ä¸æ˜¯è®¾å¤‡è¿æ¥**
   - ä¸æ¶‰åŠ WebSocket
   - ä¸æ¶‰åŠè®¾å¤‡é…å¯¹
   - çº¯ç²¹æ˜¯ç”¨æˆ·æˆæƒæœºåˆ¶

2. **ç”¨é€”**
   - æ§åˆ¶ DM è®¿é—®æƒé™
   - é˜²æ­¢åƒåœ¾æ¶ˆæ¯
   - éœ€è¦ç®¡ç†å‘˜æ‰¹å‡†

3. **å®ç°**
   - æœåŠ¡å™¨ç«¯å­˜å‚¨
   - é…å¯¹ç éªŒè¯
   - Allowlist ç®¡ç†

---

## æ€»ç»“

### æ¶æ„æ ¸å¿ƒè¦ç‚¹

1. **Telegram Bot æ˜¯æ’ä»¶ï¼Œä¸æ˜¯å®¢æˆ·ç«¯**
   - åœ¨æœåŠ¡å™¨è¿›ç¨‹å†…è¿è¡Œ
   - é€šè¿‡å‡½æ•°è°ƒç”¨è®¿é—® Agent
   - ç”± Gateway ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

2. **Gateway æœ‰ä¸‰ä¸ªç‹¬ç«‹èŒè´£**
   - ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢ channelsï¼‰
   - WebSocket APIï¼ˆæœåŠ¡å¤–éƒ¨å®¢æˆ·ç«¯ï¼‰
   - äº‹ä»¶å¹¿æ’­ï¼ˆåˆ†å‘ Agent äº‹ä»¶ï¼‰

3. **å››ç§ä¸åŒçš„é€šä¿¡æ–¹å¼**
   - Bot â†” Telegram APIï¼šHTTP
   - Bot â†” Agentï¼šå‡½æ•°è°ƒç”¨
   - Gateway â†” å®¢æˆ·ç«¯ï¼šWebSocket
   - Agent â†” LLMï¼šHTTPS

4. **æ¶ˆæ¯æµç¨‹æ¸…æ™°**
   - ç”¨æˆ·æ¶ˆæ¯ â†’ Telegram API â†’ Bot â†’ Agent â†’ LLM
   - LLM å“åº” â†’ Agent â†’ Bot â†’ Telegram API â†’ ç”¨æˆ·
   - åŒæ—¶ï¼šAgent äº‹ä»¶ â†’ Gateway â†’ WebSocket å®¢æˆ·ç«¯

### è¿›ä¸€æ­¥å­¦ä¹ 

- [TELEGRAM_CONNECTION_EXPLAINED.md](TELEGRAM_CONNECTION_EXPLAINED.md) - è¯¦ç»†æŠ€æœ¯è¯´æ˜
- [GATEWAY_ARCHITECTURE.md](GATEWAY_ARCHITECTURE.md) - Gateway æ¶æ„è¯¦è§£
- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°
- [examples/10_gateway_telegram_bridge.py](examples/10_gateway_telegram_bridge.py) - å®Œæ•´ä»£ç å®ç°

---

**ç°åœ¨ä½ åº”è¯¥å®Œå…¨ç†è§£ OpenClaw çš„æ¶æ„äº†ï¼** ğŸ‰
