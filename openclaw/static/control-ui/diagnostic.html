<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Diagnostic</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1d25;
            color: #e4e4e7;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 { color: #ff5c5c; margin-bottom: 30px; }
        .section { 
            background: #181b22; 
            border: 1px solid #27272a;
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px; 
        }
        .status { padding: 12px; margin: 10px 0; border-radius: 8px; }
        .ok { background: rgba(34, 197, 94, 0.15); border-left: 4px solid #22c55e; }
        .error { background: rgba(239, 68, 68, 0.15); border-left: 4px solid #ef4444; }
        .pending { background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; }
        code { 
            background: rgba(0,0,0,0.3); 
            padding: 2px 6px; 
            border-radius: 4px; 
            font-family: monospace;
        }
        pre {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }
        button {
            background: #ff5c5c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 10px 0 0;
        }
        button:hover { background: #ff7070; }
        .result { margin-top: 15px; }
    </style>
</head>
<body>
    <h1>ğŸ¦ OpenClaw å‰ç«¯è¯Šæ–­</h1>
    
    <div class="section">
        <h3>1. åŸºç¡€è¿æ¥æµ‹è¯•</h3>
        <div id="http-test" class="status pending">â³ æµ‹è¯•HTTPæœåŠ¡å™¨...</div>
        <div id="ws-test" class="status pending">â³ æµ‹è¯•WebSocketè¿æ¥...</div>
    </div>
    
    <div class="section">
        <h3>2. é™æ€èµ„æºæ£€æŸ¥</h3>
        <div id="js-test" class="status pending">â³ æ£€æŸ¥JavaScriptæ–‡ä»¶...</div>
        <div id="css-test" class="status pending">â³ æ£€æŸ¥CSSæ–‡ä»¶...</div>
    </div>
    
    <div class="section">
        <h3>3. Web Componentæ£€æŸ¥</h3>
        <div id="component-test" class="status pending">â³ æ£€æŸ¥ &lt;openclaw-app&gt; å…ƒç´ ...</div>
    </div>
    
    <div class="section">
        <h3>4. é…ç½®ä¿¡æ¯</h3>
        <div id="config-test" class="status pending">â³ æ£€æŸ¥é…ç½®æ³¨å…¥...</div>
        <div class="result">
            <pre id="config-data">ç­‰å¾…ä¸­...</pre>
        </div>
    </div>
    
    <div class="section">
        <h3>5. GatewayçŠ¶æ€</h3>
        <button onclick="testGateway()">åˆ·æ–°GatewayçŠ¶æ€</button>
        <div class="result">
            <pre id="gateway-data">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
        </div>
    </div>
    
    <div class="section">
        <h3>6. æµè§ˆå™¨ä¿¡æ¯</h3>
        <pre id="browser-info"></pre>
    </div>
    
    <script>
        // æµ‹è¯•1: HTTPæœåŠ¡å™¨
        fetch('/health')
            .then(r => r.json())
            .then(data => {
                document.getElementById('http-test').className = 'status ok';
                document.getElementById('http-test').textContent = 'âœ… HTTPæœåŠ¡å™¨æ­£å¸¸: ' + JSON.stringify(data);
            })
            .catch(e => {
                document.getElementById('http-test').className = 'status error';
                document.getElementById('http-test').textContent = 'âŒ HTTPæµ‹è¯•å¤±è´¥: ' + e;
            });
        
        // æµ‹è¯•2: WebSocket
        const wsUrl = 'ws://127.0.0.1:18789';
        const ws = new WebSocket(wsUrl);
        ws.onopen = () => {
            document.getElementById('ws-test').className = 'status ok';
            document.getElementById('ws-test').textContent = 'âœ… WebSocketè¿æ¥æˆåŠŸ: ' + wsUrl;
            ws.close();
        };
        ws.onerror = (e) => {
            document.getElementById('ws-test').className = 'status error';
            document.getElementById('ws-test').textContent = 'âŒ WebSocketè¿æ¥å¤±è´¥: ' + wsUrl;
        };
        
        // æµ‹è¯•3: JavaScriptæ–‡ä»¶
        fetch('/assets/index-C_TY5Tiw.js', { method: 'HEAD' })
            .then(r => {
                if (r.ok) {
                    document.getElementById('js-test').className = 'status ok';
                    document.getElementById('js-test').textContent = 
                        `âœ… JavaScriptæ–‡ä»¶å¯è®¿é—® (${(r.headers.get('content-length')/1024).toFixed(1)}KB, ${r.headers.get('content-type')})`;
                } else {
                    throw new Error(`HTTP ${r.status}`);
                }
            })
            .catch(e => {
                document.getElementById('js-test').className = 'status error';
                document.getElementById('js-test').textContent = 'âŒ JavaScriptæ–‡ä»¶åŠ è½½å¤±è´¥: ' + e;
            });
        
        // æµ‹è¯•4: CSSæ–‡ä»¶
        fetch('/assets/index-B_pAAEiP.css', { method: 'HEAD' })
            .then(r => {
                if (r.ok) {
                    document.getElementById('css-test').className = 'status ok';
                    document.getElementById('css-test').textContent = 
                        `âœ… CSSæ–‡ä»¶å¯è®¿é—® (${(r.headers.get('content-length')/1024).toFixed(1)}KB)`;
                } else {
                    throw new Error(`HTTP ${r.status}`);
                }
            })
            .catch(e => {
                document.getElementById('css-test').className = 'status error';
                document.getElementById('css-test').textContent = 'âŒ CSSæ–‡ä»¶åŠ è½½å¤±è´¥: ' + e;
            });
        
        // æµ‹è¯•5: Web Component
        setTimeout(() => {
            const element = document.querySelector('openclaw-app');
            if (element) {
                document.getElementById('component-test').className = 'status ok';
                document.getElementById('component-test').textContent = 
                    `âœ… Web Componentå­˜åœ¨ (shadowRoot: ${!!element.shadowRoot})`;
            } else {
                document.getElementById('component-test').className = 'status error';
                document.getElementById('component-test').textContent = 
                    'âŒ æœªæ‰¾åˆ° <openclaw-app> å…ƒç´ ï¼ˆåœ¨ä¸»é¡µé¢ä¸­ï¼‰';
            }
        }, 1000);
        
        // æµ‹è¯•6: é…ç½®
        if (window.__OPENCLAW_CONFIG__) {
            document.getElementById('config-test').className = 'status ok';
            document.getElementById('config-test').textContent = 'âœ… é…ç½®å·²æ³¨å…¥';
            document.getElementById('config-data').textContent = JSON.stringify(window.__OPENCLAW_CONFIG__, null, 2);
        } else {
            document.getElementById('config-test').className = 'status error';
            document.getElementById('config-test').textContent = 'âŒ é…ç½®æœªæ³¨å…¥';
            document.getElementById('config-data').textContent = 'æœªæ‰¾åˆ° window.__OPENCLAW_CONFIG__';
        }
        
        // æµè§ˆå™¨ä¿¡æ¯
        document.getElementById('browser-info').textContent = 
            `User Agent: ${navigator.userAgent}\n` +
            `Platform: ${navigator.platform}\n` +
            `Language: ${navigator.language}\n` +
            `Online: ${navigator.onLine}\n` +
            `Cookies Enabled: ${navigator.cookieEnabled}`;
        
        // Gatewayæµ‹è¯•
        async function testGateway() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch('/health');
                const data = await response.json();
                document.getElementById('gateway-data').textContent = JSON.stringify(data, null, 2);
                btn.textContent = 'âœ… æµ‹è¯•æˆåŠŸ';
            } catch (e) {
                document.getElementById('gateway-data').textContent = 'é”™è¯¯: ' + e;
                btn.textContent = 'âŒ æµ‹è¯•å¤±è´¥';
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'åˆ·æ–°GatewayçŠ¶æ€';
                }, 2000);
            }
        }
    </script>
</body>
</html>
